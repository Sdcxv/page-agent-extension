<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Page Agent 设置</title>
  <link rel="stylesheet" href="options.css">
</head>

<body>
  <div class="container">
    <header class="header">
      <div class="logo">
        <span class="logo-icon">🤖</span>
        <h1>Page Agent 设置</h1>
      </div>
      <p class="subtitle">配置 LLM 端点和工具选项</p>
    </header>

    <main class="main">
      <!-- LLM 配置 -->
      <section class="section">
        <h2 class="section-title">
          <span class="section-icon">🧠</span>
          LLM 配置
        </h2>
        <div class="section-content">
          <div class="form-group">
            <label for="baseUrl">API Base URL</label>
            <input type="url" id="baseUrl" placeholder="https://api.openai.com/v1" />
            <p class="hint">LLM API 的基础地址，留空使用默认测试端点</p>
          </div>

          <div class="form-group">
            <label for="apiKey">API Key</label>
            <div class="input-with-toggle">
              <input type="password" id="apiKey" placeholder="sk-..." />
              <button type="button" class="toggle-visibility" id="toggleApiKey">👁️</button>
            </div>
            <p class="hint">您的 API 密钥，将安全存储在本地</p>
          </div>

          <div class="form-group">
            <label for="model">模型名称</label>
            <input type="text" id="model" placeholder="gpt-4" />
            <p class="hint">要使用的模型名称，如 gpt-4、deepseek-chat、gemini-2.5-flash</p>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="temperature">Temperature</label>
              <div class="range-input">
                <input type="range" id="temperature" min="0" max="1" step="0.1" value="0.7" />
                <span class="range-value" id="temperatureValue">0.7</span>
              </div>
              <p class="hint">较高的值使输出更随机</p>
            </div>

            <div class="form-group">
              <label for="maxTokens">Max Tokens</label>
              <input type="number" id="maxTokens" min="256" max="32768" value="4096" />
              <p class="hint">单次响应的最大 token 数</p>
            </div>
          </div>

          <div class="form-group">
            <label for="maxRetries">最大重试次数</label>
            <input type="number" id="maxRetries" min="0" max="10" value="2" />
            <p class="hint">API 调用失败时的重试次数</p>
          </div>

          <div class="form-group"
            style="margin-top: 24px; border-top: 1px solid var(--border-color); padding-top: 24px; display: flex; gap: 12px; flex-direction: column;">
            <button type="button" class="btn btn-secondary" id="testBtn">⚡ 测试连接 (Chat)</button>
            <button type="button" class="btn btn-secondary" id="testToolBtn">🛠️ 测试 Tool Use (智能识别工具)</button>
            <div id="testResult" class="test-result" style="display: none;"></div>
          </div>
        </div>
      </section>

      <!-- 工具配置 -->
      <section class="section">
        <h2 class="section-title">
          <span class="section-icon">🛠️</span>
          工具配置
        </h2>
        <div class="section-content">
          <p class="section-desc">选择要启用的工具。禁用的工具将不会被 Agent 使用。</p>
          <div class="tools-grid" id="toolsGrid">
            <!-- Tools will be populated by JavaScript -->
          </div>
        </div>
      </section>

      <!-- UI 配置 -->
      <section class="section">
        <h2 class="section-title">
          <span class="section-icon">🎨</span>
          界面设置
        </h2>
        <div class="section-content">
          <div class="form-group">
            <label for="language">界面语言</label>
            <select id="language">
              <option value="zh-CN">简体中文</option>
              <option value="en-US">English</option>
            </select>
          </div>
          <div class="form-group">
            <label for="interactionMode">交互模式</label>
            <select id="interactionMode">
              <option value="debugger">增强模式 (使用 Debugger - 更稳健但有提示条)</option>
              <option value="simulated">兼容模式 (旧版 - 模拟点击，低干扰)</option>
            </select>
            <p class="hint">增强模式支持物理点击和绕过某些框架保护，但会在页面上方显示调试提示条。</p>
          </div>
        </div>
      </section>

      <!-- 运行日志 -->
      <section class="section">
        <h2 class="section-title">
          <span class="section-icon">📜</span>
          运行日志
        </h2>
        <div class="section-content">
          <div class="log-controls">
            <button type="button" class="btn btn-sm btn-secondary" id="refreshLogsBtn">🔄 刷新</button>
            <button type="button" class="btn btn-sm btn-secondary" id="exportLogsBtn">💾 导出 (JSON)</button>
            <button type="button" class="btn btn-sm btn-danger" id="clearLogsBtn">🗑️ 清空</button>
          </div>
          <div class="log-container" id="logContainer">
            <div class="log-placeholder">点击刷新以查看由于跳转或调试产生的日志...</div>
          </div>
        </div>
      </section>
    </main>

    <footer class="footer">
      <div class="footer-status">
        <span class="status-indicator" id="statusIndicator"></span>
        <span id="statusText">已加载配置</span>
      </div>
      <div class="footer-actions">
        <button type="button" class="btn btn-secondary" id="resetBtn">重置为默认</button>
        <button type="button" class="btn btn-primary" id="saveBtn">保存设置</button>
      </div>
    </footer>
  </div>

  <script type="module" src="./options.ts"></script>
</body>

</html>